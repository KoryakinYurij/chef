# Dev Server и автоматизация тестирования

## Общие принципы

При работе с dev серверами и автоматизацией тестирования, Kilo Code должен:

1. Автоматически устанавливать и настраивать `start-server-and-test` при обнаружении необходимости запуска dev сервера для тестирования
2. Приоритизировать использование `pnpm` вместо `npm` в проектах, где он уже используется (определять по наличию `pnpm-lock.yaml` или `pnpm-workspace.yaml`)
3. Использовать правильные порты для ожидания сервера (обычно 5173 для Vite или 3000 для Next.js)
4. Автоматически завершать предыдущие процессы при необходимости

## Автоматизация установки и настройки

Когда Kilo Code обнаруживает, что dev сервер "зависает" или не завершается корректно:

1. Установить `start-server-and-test` как dev зависимость:
   ```bash
   pnpm install --save-dev start-server-and-test
   ```

2. Добавить соответствующий скрипт в `package.json`:
   - Для Vite/Remix проектов: `"dev-test": "start-test dev http://127.0.0.1:5173 test"`
   - Для Next.js проектов: `"dev-test": "start-test dev http://localhost:3000 test"`

3. Запускать тесты с помощью команды `pnpm run dev-test` вместо отдельного запуска сервера

## Работа с портами

- Определять используемый порт по выводу dev сервера (обычно в формате `Local: http://127.0.0.1:XXXX/`)
- При добавлении скрипта в `package.json`, использовать тот же порт для ожидания сервера
- При конфликтах портов - завершать предыдущие процессы командой `taskkill /PID <PID> /F` (Windows) или `kill -9 <PID>` (Linux/Mac)

## Работа с разными менеджерами пакетов

- Определять используемый менеджер пакетов по наличию:
  - `pnpm-lock.yaml` → использовать `pnpm`
  - `yarn.lock` → использовать `yarn`
  - `package-lock.json` → использовать `npm`
- Соответственно использовать команды `pnpm install`, `yarn add`, `npm install`
- При добавлении зависимостей использовать `--save-dev` для dev зависимостей

## Обработка ошибок

- При ошибке "Port is already in use" - автоматически завершать процессы, использующие порт
- При неудачном запуске тестов - информировать пользователя о результатах
- При успешном завершении тестов - сервер должен автоматически остановиться благодаря `start-server-and-test`

## Для новых проектов

При создании новых проектов Kilo Code должен:

1. Устанавливать `start-server-and-test` как часть стандартного набора dev зависимостей
2. Добавлять скрипт `dev-test` в `package.json` сразу при инициализации
3. Настраивать правильные порты в зависимости от типа проекта (Vite, Next.js, Express и т.д.)
4. Включать в документацию проекта инструкции по использованию `dev-test` скрипта